---
title: Provisioning Environments
---

# Provisioning Environments

This section provides a comprehensive guide to provisioning environments using the home-ops repository. It covers the following topics:

- Provisioning K8s
- Provisioning gitops via FluxCD
- Deploying sealed-secrets to enable secret encryption

> Note, this guide assumes you have already completed the [Prepare Hypervisor](01-prepare-hypervisor) and [Prepare DEV](02-prepare-dev) sections. If you haven't, please do so before proceeding.

> Note, this guide will provision a single environment. If you want to provision multiple environments, you will need to repeat the steps for each environment. The steps are the same for each environment, but the OnePassword vaults will be different.

## Sourcing Secrets

The required environment variable secrets are listed in the file `example.secrets.env`. Note you will need a 1Password vault ID and a 1Password token that has read/write access to the vault. It is recommended to have a separate vault per environment. The vault ID and token can be found in the 1Password web interface.

> Note, all secrets stored in 1Password may be provided as environment variables. Environment variable equivalents are all uppercase and replace `/` with `_`. For example, the secret `k8s/config` is available as `K8S_CONFIG`.

> Note, a list of required secrets that require values may be found in the `./packages/configuration-1password-cli/src/index.ts` file.

```bash
ENV=production

cp example.secrets.env .secrets.${ENV}.env
# Fill in values in .secrets.${ENV}.env file.

set -o allexport
source .secrets.${ENV}.env
```

## Provision K8s, gitops, and sealed-secrets

> Note this will automatically set the `k8s/config` secret in OnePassword.

```bash
yarn nx provision resource-fluxcd
```
